# 에이전트 설계서 작성 프롬프트 v2.0

> 이 문서는 Claude Code 워크스페이스에서 에이전트/스킬 시스템을 설계할 때 사용하는 범용 템플릿이다.
> 사용자가 작업 개요를 입력하면, 이 프롬프트에 따라 인터뷰 → 설계서 작성 → 리뷰 순으로 진행한다.

---

나는 [작업명]을 자동화하는 에이전트 시스템을 설계하려고 한다.

## 작업 개요

- **목적**:
- **입력**:
- **출력**:
- **주요 제약조건**:

---

## 내가 원하는 산출물

최종적으로 **하나의 통합 설계서 문서(md 파일)**를 만들고 싶다.
이 문서는 Claude Code에서 구체적인 구현을 할 때 참조할 **계획서** 역할을 한다.

### 설계서에 포함될 내용

1. **작업 컨텍스트 문서**
   - 배경, 목적, 범위, 입출력 정의, 제약조건, 용어 정의

2. **워크플로우 정의**
   - 단계별 흐름도, 분기조건, 상태 전이
   - LLM 판단 영역과 코드 처리 영역 구분
   - LLM이 직접 수행할 판단/의사결정 단계 명시
   - 각 단계의 성공 기준 및 검증 방법
   - 실패 시 처리 방식 (재시도 / 에스컬레이션 / 스킵)
   - **각 단계의 모델 지정** (haiku / sonnet / opus)

3. **구현 스펙** (구조 개요만, 상세 내용 X)
   - 배치 유형 및 폴더 구조
   - CLAUDE.md 핵심 섹션 목록
   - 에이전트 구조 (단일 또는 서브에이전트)
   - 작업 단계별 처리 방식 (에이전트 판단 vs 스크립트)
   - 스킬/스크립트 파일 목록, 역할, 트리거 조건(언제 이 스킬이 호출되는가)
   - 서브에이전트 사용 시: 이름, 역할, 입출력, 데이터 전달 방식
   - 주요 산출물 파일 형식
   - **MCP 통합** (소비/제공하는 MCP 서버)
   - **기존 자산 재사용** (확장/참조/대체할 기존 에이전트·스킬·MCP 서버)

4. **설계서 생명주기**
   - 이 설계서의 저장 위치, 구현 파일과의 관계, 갱신 방법

---

## 설계 원칙

### [배치 유형과 폴더 구조]

이 워크스페이스는 **2-레벨 구조**를 사용한다. 새 시스템을 설계할 때 아래 기준으로 배치 유형을 결정한다.

**Type A: 루트 레벨 에이전트/스킬** — 범용 역할, 워크플로우 오케스트레이션
```
/workspace-root
  ├── CLAUDE.md                           # 메인 에이전트 지침 (오케스트레이터)
  ├── .claude/agents/<name>.md            # 범용 에이전트 (플랫 파일)
  ├── .claude/skills/<skill-name>/
  │   ├── SKILL.md                        # 스킬 진입점
  │   ├── /scripts/                       # 결정론적 도구
  │   └── /references/                    # (선택) 도메인 지식, API 가이드
  ├── research/sessions/                   # 리서치/분석 산출물
  └── docs/                                # 설계 문서 (*.skill.md, *.agent.md)
```

**Type B: 프로젝트 레벨 MCP 서버** — 도메인 데이터 저장/조회, 외부 API 래핑
```
/workspace-root/projects/<name>/
  ├── CLAUDE.md                           # 프로젝트 전용 지침
  ├── pyproject.toml                       # 독립 의존성
  ├── src/                                 # MCP 서버 구현
  └── tests/
```

**배치 판단 기준:**

| 질문 | Yes → Type | 설명 |
|------|-----------|------|
| 외부 데이터를 저장/조회해야 하는가? | B (MCP 서버) | DB, 외부 API 래핑 |
| 다른 스킬/에이전트에서 도구로 호출되는가? | B (MCP 서버) | `.mcp.json`에 등록 |
| 사용자가 `/command`로 직접 호출하는가? | A (스킬) | `.claude/skills/` |
| Task 서브에이전트로 자동 배정되는가? | A (에이전트) | `.claude/agents/` |
| 복합 워크플로우를 오케스트레이션하는가? | A (스킬) | 여러 에이전트/MCP 조합 |

### [판단과 코드의 역할 분리]

| 에이전트(LLM)가 직접 수행 | 스크립트로 처리 |
|--------------------------|----------------|
| 분류, 의사결정, 우선순위 판단 | 파일 I/O, 데이터 파싱 |
| 품질 평가, 정성적 분석 | 외부 API 호출 |
| 컨텍스트 기반 추론 | 반복 처리, 집계 |
| 자연어 생성/요약 | 정적 분석, 테스트 실행 |

### [모델 선택 기준]

워크플로우 단계마다 적절한 모델을 지정한다.

| 모델 | 용도 | 토큰 비용 | 적합한 단계 |
|------|------|----------|------------|
| **haiku** | 단순 분류, 파싱, 빠른 탐색 | 최저 | 데이터 전처리, 키워드 추출, 단순 현황 조회 |
| **sonnet** | 구현, 분석, 리뷰 | 중간 | 코드 생성, 표준 분석, 검증, 리뷰 |
| **opus** | 복잡한 아키텍처, 심층 추론 | 최고 | 전략 판단, 복합 의사결정, 심층 분석 |

**원칙**: 기본은 sonnet, 단순 작업은 haiku로 내리고, 정말 필요한 경우만 opus.

### [검증 패턴]

각 워크플로우 단계에는 반드시 성공 기준을 정의한다.

| 검증 유형 | 적용 대상 | 예시 |
|-----------|----------|------|
| **스키마 검증** | 구조화된 산출물 | 필수 필드 존재, 타입 체크 |
| **규칙 기반** | 정량 기준이 있는 작업 | 항목 수, 글자 수, 필수 섹션 포함 |
| **LLM 자기 검증** | 정성적 판단 작업 | 요약 품질, 톤 적합성, 누락 여부 |
| **사람 검토** | 고위험 최종 산출물 | 외부 발송 문서, 의사결정 |

설계서 작성 시 각 단계마다 다음을 명시한다:
- **성공 기준**: 이 단계의 산출물이 충족해야 할 조건
- **검증 방법**: 위 유형 중 어떤 방식으로 확인하는가
- **실패 시 처리**: 아래 패턴 중 선택

### [실패 처리]

| 방식 | 사용 시점 |
|------|----------|
| **자동 재시도** | 검증 실패가 단순 누락/형식 오류인 경우 (최대 재시도 횟수 명시) |
| **에스컬레이션** | 판단 불확실성이 높거나 기준 자체가 모호한 경우 → 사람에게 확인 요청 |
| **스킵 + 로그** | 선택적 단계이며 전체 흐름에 영향 없는 경우 → 사유를 로그에 기록 |

### [스킬 vs 에이전트 구분]

| 기준 | 스킬 (`.claude/skills/*/SKILL.md`) | 에이전트 (`.claude/agents/*.md`) |
|------|-----------------------------------|--------------------------------|
| **호출 방식** | 사용자가 `/command`로 직접 호출 | Task 서브에이전트로 자동 배정 |
| **주체성** | 절차적 — 정해진 워크플로우 실행 | 자율적 — 판단 위임 |
| **컨텍스트** | 워크플로우 전용 지침 | 범용 역할 지침 |
| **공유성** | 특정 워크플로우 전용 | 여러 작업에서 재사용 |
| **예시** | WTIS, research-session, slides | implementer, researcher, reviewer |

### [에이전트 구조 선택]

**단일 에이전트** (기본):
- 워크플로우가 단순하고 지침이 짧을 때

**서브에이전트 분리** (필요 시):
- **컨텍스트 윈도우 최적화가 필요할 때** — 지침이 길어서 항상 로드하면 비효율적인 경우, 서브에이전트로 분리하여 필요한 시점에만 해당 지침 로드
- 독립적인 작업 블록이 명확히 구분되고, 각각 다른 도메인 지식이 필요할 때

### [서브에이전트 설계]

- 메인 에이전트(CLAUDE.md)가 오케스트레이터 역할
- 서브에이전트 간 직접 호출 금지 → 메인을 통해 조율
- AGENT.md에 역할, 트리거 조건, 입출력, 참조 스킬 명시

### [데이터 전달 패턴]

| 방식 | 사용 시점 |
|------|----------|
| **파일 기반** | 데이터가 크거나 구조화된 경우 → `research/sessions/` 또는 프로젝트별 output 경로 |
| **프롬프트 인라인** | 데이터가 작고 단순한 경우 |

권장: 중간 산출물은 지정된 경로에 저장하고 파일 경로만 전달.

### [MCP 통합]

새 시스템이 데이터를 다루면 MCP 서버 여부를 판단한다.

| 질문 | Yes → MCP 서버 고려 |
|------|-------------------|
| 외부 DB/API에서 데이터를 가져오는가? | `projects/`에 MCP 서버 프로젝트 생성 |
| 다른 스킬이 이 데이터를 조회해야 하는가? | `.mcp.json`에 등록 |
| 데이터가 세션을 넘어 지속되어야 하는가? | DB 저장 + MCP 도구 노출 |

설계서에 명시할 항목:
- **소비하는 MCP 서버**: 이 에이전트/스킬이 호출하는 기존 MCP 도구 목록
- **제공하는 MCP 서버** (해당 시): 새로 노출하는 MCP 도구
- **`.mcp.json` 등록 계획** (해당 시)

### [설계서 생명주기]

```
[설계]   docs/<name>.skill.md 또는 docs/<name>.agent.md
              ↓ 리뷰 & 승인
[구현]   .claude/skills/<name>/SKILL.md 또는 .claude/agents/<name>.md
              ↓ 운영 & 피드백
[갱신]   docs/ 설계서 + 구현 파일 동시 업데이트
```

- 설계서는 `docs/`에 보관 — 의사결정 기록, 아키텍처 근거
- 구현 파일은 `.claude/`에 배치 — 런타임 실행
- 설계 변경 시 `docs/` 문서의 버전을 올리고 구현에 반영
- 설계서의 상세 지침은 구현 단계에서 작성 (설계서에는 구조와 역할까지만)

---

## 주의사항

- CLAUDE.md, AGENT.md, 스킬 파일의 **상세 내용은 작성하지 않는다** (구현 시 작성)
- 구현 스펙은 **구조와 역할 정의 수준**까지만

---

## 진행 방식

### 1단계: 작업 파악 (필수 확인 항목)

사용자 입력을 받으면 아래 영역의 정보가 충분한지 판단한다.
**부족한 영역이 있으면 해당 영역의 질문만 한다. 모두 충분하면 바로 설계에 착수한다.**

| 영역 | 확인할 것 | 부족할 때 질문 예시 |
|------|----------|-------------------|
| **목표와 성공 기준** | 이 에이전트가 궁극적으로 달성해야 할 목표가 명확한가? 성공/실패를 판단할 수 있는 기준이 있는가? | "이 에이전트가 잘 작동했다는 걸 어떻게 알 수 있나요?" |
| **작업 절차** | 입력→출력까지의 구체적 단계가 있는가? 분기 조건이 명확한가? | "A 이후에 B로 갈지 C로 갈지는 어떤 기준으로 판단하나요?" |
| **에이전트 조직** | 단일/멀티 에이전트 선호가 있는가? 역할 분리 기준이 있는가? | "이 작업을 하나의 에이전트가 순차 처리하면 되나요?" |
| **기술/도구 대안** | 현재 쓰는 도구가 있는가? 목적에 맞는 도구·API·라이브러리를 역제시하여 선택을 도울 수 있는가? | "지금 쓰고 있는 도구가 있나요?" |
| **기존 자산 관계** | 확장/대체할 기존 에이전트·스킬·MCP 서버가 있는가? | "기존 researcher 에이전트를 확장하는 건가요, 별도로 만드는 건가요?" |
| **배치 유형** | Type A(루트 에이전트/스킬)인가, Type B(MCP 서버)인가, 혹은 조합인가? | "이 시스템이 외부 데이터를 지속적으로 저장해야 하나요?" |

### 질문 원칙

- 질문은 뻔하거나 상투적이지 않아야 하며, 매우 심층적으로 접근하여 내용이 완성될 때까지 인터뷰를 계속 이어가야 합니다 (최대 3턴)
- 사용자가 모르겠다고 하면 설계 원칙에 따라 LLM이 판단하고 그 근거를 명시한다
- 사용자가 "알아서 해줘"라고 하면, 합리적 기본값을 적용하되 핵심 선택지만 확인한다

### 2단계: 설계서 작성

확인이 끝나면 "설계서에 포함될 내용"에 따라 통합 설계서(md 파일)를 `docs/`에 작성한다.

### 3단계: 리뷰

설계서 초안을 제시하고, 수정할 부분이 있는지 확인한다.
